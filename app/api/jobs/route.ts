import { NextRequest, NextResponse } from 'next/server';import { createClient } from '@supabase/supabase-js';const sb=createClient(process.env.SUPABASE_URL as string, process.env.SUPABASE_SERVICE_KEY as string);export async function GET(){const {data,error}=await sb.from('jobs').select('*').eq('status','published').order('created_at',{ascending:false}).limit(50);if(error)return NextResponse.json({error:error.message},{status:400});return NextResponse.json({jobs:data})}export async function POST(req:NextRequest){const b=await req.json();const {company_id,title,description,location,credit_cost=1}=b;if(!company_id||!title||!description)return NextResponse.json({error:'Missing fields'},{status:400});const ok=await sb.rpc('consume_credits',{p_company:company_id,p_cost:credit_cost,p_reason:'post_job',p_meta:b});if(ok.error)return NextResponse.json({error:'Insufficient credits'},{status:402});const {data,error}=await sb.from('jobs').insert({company_id,title,description,location,status:'published',credit_cost}).select().single();if(error)return NextResponse.json({error:error.message},{status:400});return NextResponse.json({job:data})}