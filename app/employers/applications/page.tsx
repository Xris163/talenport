'use client';import {useEffect,useMemo,useState} from 'react';type Row={id:string;created_at:string;status:string;note?:string;cv_url?:string;candidate_id:string;jobs?:{id:string;title:string;company_id:string}};export default function Page(){const[rows,setRows]=useState<Row[]>([]);const[q,setQ]=useState('');const companyId='demo-company-uuid';async function load(){const r=await fetch(`/api/employers/applications?company_id=${companyId}`);const j=await r.json();if(j.error)return alert(j.error);setRows(j.applications||[]);}useEffect(()=>{load()},[]);const filtered=useMemo(()=>!q?rows:rows.filter(r=>(r.jobs?.title||'').toLowerCase().includes(q.toLowerCase())||(r.candidate_id||'').includes(q)),[rows,q]);function exportCsv(){location.href=`/api/employers/applications/export?company_id=${companyId}`}async function updateStatus(id:string,status:string){const res=await fetch(`/api/applications/${id}/status`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({status})});const j=await res.json();if(j.error)return alert(j.error);load()}return(<main className='container section'><h2 style={{color:'var(--accent)'}}>Žiadosti uchádzačov</h2><div className='card' style={{display:'flex',gap:10,alignItems:'center'}}><input placeholder='Hľadať podľa pozície / ID kandidáta' onChange={e=>setQ(e.target.value)} style={{flex:1}}/><button className='btn solid' onClick={exportCsv}>Export CSV</button></div><div className='card' style={{marginTop:12,overflowX:'auto'}}><table style={{width:'100%',borderCollapse:'collapse'}}><thead><tr style={{textAlign:'left'}}><th style={{padding:'10px'}}>Dátum</th><th style={{padding:'10px'}}>Pozícia</th><th style={{padding:'10px'}}>Kandidát</th><th style={{padding:'10px'}}>CV</th><th style={{padding:'10px'}}>Stav</th><th style={{padding:'10px'}}>Poznámka</th><th style={{padding:'10px'}}>Akcie</th></tr></thead><tbody>{filtered.map(r=>(<tr key={r.id} style={{borderTop:'1px solid var(--line)'}}><td style={{padding:'10px'}}>{new Date(r.created_at).toLocaleString()}</td><td style={{padding:'10px'}}>{r.jobs?.title}</td><td style={{padding:'10px',fontFamily:'monospace'}}>{r.candidate_id.slice(0,8)}…</td><td style={{padding:'10px'}}>{r.cv_url?<a href={`/api/cv/signed?path=${encodeURIComponent(r.cv_url)}`} target='_blank' rel='noreferrer'>CV</a>:'—'}</td><td style={{padding:'10px'}}><select value={r.status} onChange={e=>updateStatus(r.id,e.target.value)}><option value='applied'>applied</option><option value='review'>review</option><option value='rejected'>rejected</option><option value='accepted'>accepted</option></select></td><td style={{padding:'10px'}}>{r.note||'—'}</td><td style={{padding:'10px'}}><a className='btn' href={`/jobs/${r.jobs?.id}`} target='_blank' rel='noreferrer'>Detail</a></td></tr>))}{!filtered.length&&(<tr><td colSpan={7} style={{padding:'12px'}}>Žiadne záznamy</td></tr>)}</tbody></table></div></main>)}